{% extends 'admin/custom_admin_base.html' %}

{% block title %}Lista de Notícias{% endblock %}

{% block page_title %}
    <div class="flex justify-between items-center w-full">
        <span>Gerenciador de Notícias</span>
        <a href="{{ url_for('custom_news_form') }}" class="bg-primary hover:bg-blue-800 text-white font-bold py-2 px-4 rounded inline-flex items-center transition-colors duration-200">
            <i class="fas fa-plus mr-2"></i>
            <span>Nova Notícia</span>
        </a>
    </div>
{% endblock %}

{% block content %}
<div class="bg-dark-secondary p-6 rounded-lg shadow-lg">
    
    <!-- Filtros e Busca -->
    <div class="mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="relative w-full md:w-1/3">
            <input type="text" placeholder="Buscar por título..." class="w-full bg-dark-tertiary border border-gray-600 rounded-md py-2 pl-10 pr-4 text-white focus:ring-primary focus:border-primary">
            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
        <div class="flex items-center gap-4">
            <select class="bg-dark-tertiary border border-gray-600 rounded-md p-2 text-white focus:ring-primary focus:border-primary">
                <option value="">Todos os Status</option>
                <option value="published">Publicado</option>
                <option value="draft">Rascunho</option>
                <option value="scheduled">Agendado</option>
            </select>
             <select class="bg-dark-tertiary border border-gray-600 rounded-md p-2 text-white focus:ring-primary focus:border-primary">
                <option value="">Todas as Categorias</option>
                <!-- Categorias serão carregadas dinamicamente -->
            </select>
        </div>
    </div>

    <!-- Tabela de Notícias -->
    <div class="overflow-x-auto">
        <table class="w-full text-left">
            <thead>
                <tr class="text-gray-400 border-b-2 border-dark-tertiary">
                    <th class="py-3 px-4">Título</th>
                    <th class="py-3 px-4">Autor</th>
                    <th class="py-3 px-4">Categoria</th>
                    <th class="py-3 px-4">Status</th>
                    <th class="py-3 px-4">Data de Publicação</th>
                    <th class="py-3 px-4 text-right">Ações</th>
                </tr>
            </thead>
            <tbody>
                <!-- Linhas da tabela serão geradas dinamicamente -->
                {% for news_item in news_pagination.items %}
                <tr class="border-b border-dark-tertiary hover:bg-dark-tertiary transition-colors">
                    <td class="py-3 px-4 font-medium">{{ news_item.title | truncate(50) }}</td>
                    <td class="py-3 px-4 text-gray-300">{{ news_item.author_user.username if news_item.author_user else 'N/A' }}</td>
                    <td class="py-3 px-4 text-gray-300">{{ news_item.category_rel.name if news_item.category_rel else 'N/A' }}</td>
                    <td class="py-3 px-4">
                        {% if news_item.status == 'published' %}
                            <span class="px-2 py-1 text-xs font-semibold text-green-800 bg-green-200 rounded-full">Publicado</span>
                        {% elif news_item.status == 'draft' %}
                            <span class="px-2 py-1 text-xs font-semibold text-yellow-800 bg-yellow-200 rounded-full">Rascunho</span>
                        {% else %}
                            <span class="px-2 py-1 text-xs font-semibold text-gray-800 bg-gray-400 rounded-full">{{ news_item.status | capitalize }}</span>
                        {% endif %}
                    </td>
                    <td class="py-3 px-4 text-gray-400">{{ news_item.publication_date.strftime('%d/%m/%Y %H:%M') }}</td>
                    <td class="py-3 px-4 text-right">
                        <a href="{{ url_for('custom_news_form', id=news_item.id) }}" class="text-blue-400 hover:text-blue-300 mr-4" title="Editar">
                            <i class="fas fa-pencil-alt"></i>
                        </a>
                        <a href="#" class="text-red-500 hover:text-red-400" title="Excluir">
                            <i class="fas fa-trash-alt"></i>
                        </a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="py-6 text-center text-gray-500">Nenhuma notícia encontrada.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Paginação -->
    <div class="mt-6 flex justify-between items-center">
        <div class="text-sm text-gray-400">
            Exibindo {{ news_pagination.items | length }} de {{ news_pagination.total }} notícias.
        </div>
        <div class="flex items-center">
            {% if news_pagination.has_prev %}
                <a href="{{ url_for('custom_news_list', page=news_pagination.prev_num) }}" class="px-3 py-1 bg-dark-tertiary rounded-md mr-2">&laquo; Anterior</a>
            {% endif %}
            
            <span class="text-gray-400">Página {{ news_pagination.page }} de {{ news_pagination.pages }}</span>

            {% if news_pagination.has_next %}
                 <a href="{{ url_for('custom_news_list', page=news_pagination.next_num) }}" class="px-3 py-1 bg-dark-tertiary rounded-md ml-2">Próxima &raquo;</a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %} 