{% extends 'admin/admin_base.html' %}

{% block title %}{{ 'Editar' if article else 'Nova' }} Notícia{% endblock %}

{% block head_extra %}
    <script src="https://cdn.tiny.cloud/1/sjxzi8hgaefeg3rojd1y02osd0ebtfa9p1r5appzfui4zum3/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
{% endblock %}

{% block content %}
<header class="admin-header">
    <div class="admin-header-title">
        <h2 class="text-2xl font-bold text-gray-200">{{ 'Editar Notícia' if article else 'Criar Nova Notícia' }}</h2>
    </div>
    <div class="admin-header-actions">
        <a href="{{ url_for('news_list') }}" class="btn btn-secondary"><i class="ri-arrow-left-line mr-2"></i>Voltar para a lista</a>
    </div>
</header>

<div class="p-6">
    <form method="POST" enctype="multipart/form-data">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

            <!-- Coluna Principal -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- Card de Informações Básicas -->
                <div class="bg-gray-800 rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-3 flex items-center"><i class="ri-file-text-line mr-3"></i>Informações Básicas</h3>
                    
                    <div class="form-group">
                        <label for="title" class="form-label">Título da Notícia</label>
                        <input type="text" id="title" name="title" value="{{ article.title if article else '' }}" class="form-input" placeholder="Digite um título atrativo" required>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label for="slug" class="form-label">URL Amigável (Slug)</label>
                            <input type="text" id="slug" name="slug" value="{{ article.slug if article else '' }}" class="form-input" placeholder="gerado-do-titulo">
                        </div>
                        <div class="form-group">
                            <label for="subtitle" class="form-label">Subtítulo</label>
                            <input type="text" id="subtitle" name="subtitle" value="{{ article.subtitle if article else '' }}" class="form-input" placeholder="Um breve resumo">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="meta_description" class="form-label">Meta Descrição (SEO)</label>
                        <textarea id="meta_description" name="meta_description" class="form-input h-24" placeholder="Descrição para mecanismos de busca (máx. 160 caracteres)" maxlength="160">{{ article.meta_description if article else '' }}</textarea>
                    </div>
                </div>

                <!-- Card de Conteúdo -->
                <div class="bg-gray-800 rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-3 flex items-center"><i class="ri-file-list-3-line mr-3"></i>Conteúdo</h3>
                    <textarea id="content" name="content" class="tinymce">{{ article.content if article else '' }}</textarea>
                </div>
                
                <!-- Card de Mídia -->
                <div class="bg-gray-800 rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-3 flex items-center"><i class="ri-image-2-line mr-3"></i>Mídia</h3>
                     <div class="form-group">
                        <label for="featured_image" class="form-label">Imagem Destacada</label>
                        <input type="file" id="featured_image" name="featured_image" class="form-input-file">
                        {% if article and article.featured_image %}
                        <div class="mt-2">
                            <img src="{{ url_for('static', filename='uploads/images/thumb/' + article.featured_image) }}" class="h-20 rounded">
                            <label class="inline-flex items-center mt-2 text-sm text-red-400">
                                <input type="checkbox" name="remove_featured_image" class="mr-2">Remover imagem
                            </label>
                        </div>
                        {% endif %}
                    </div>
                </div>

            </div>

            <!-- Coluna Lateral (Sidebar) -->
            <div class="lg:col-span-4 space-y-6">

                <!-- Card de Publicação -->
                <div class="bg-gray-800 rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-3 flex items-center"><i class="ri-send-plane-line mr-3"></i>Publicação</h3>
                    <div class="form-group">
                        <label for="status" class="form-label">Status</label>
                        <select id="status" name="status" class="form-input">
                            <option value="draft" {% if article and article.status == 'draft' %}selected{% endif %}>Rascunho</option>
                            <option value="published" {% if article and article.status == 'published' %}selected{% endif %}>Publicado</option>
                            <option value="scheduled" {% if article and article.status == 'scheduled' %}selected{% endif %}>Agendado</option>
                        </select>
                    </div>
                    <div class="form-group" id="scheduled-date-group" {% if not article or article.status != 'scheduled' %}style="display: none;"{% endif %}>
                        <label for="publish_date" class="form-label">Data de Publicação</label>
                        <input type="datetime-local" id="publish_date" name="publish_date" value="{{ article.publication_date.strftime('%Y-%m-%dT%H:%M') if article and article.publication_date else '' }}" class="form-input">
                    </div>
                    <div class="mt-6 flex gap-4">
                        <button type="submit" class="btn btn-primary w-full justify-center">
                            <i class="ri-save-3-line mr-2"></i> {% if article %}Atualizar{% else %}Publicar{% endif %}
                        </button>
                    </div>
                </div>

                <!-- Card de Organização -->
                <div class="bg-gray-800 rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-3 flex items-center"><i class="ri-folders-line mr-3"></i>Organização</h3>
                    <div class="form-group">
                        <label for="category_id" class="form-label">Categoria</label>
                        <select name="category_id" id="category_id" class="form-input">
                            <option value="">Nenhuma</option>
                            {% for category in all_categories %}
                            <option value="{{ category.id }}" {% if article and article.category_id == category.id %}selected{% endif %}>{{ category.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tags" class="form-label">Tags</label>
                        <input type="text" id="tags" name="tags" value="{{ article.tags|join(', ') if article and article.tags else '' }}" class="form-input" placeholder="tecnologia, notícias, ...">
                    </div>
                </div>
                
                <!-- Card de Opções -->
                 <div class="bg-gray-800 rounded-lg shadow-md p-6">
                     <h3 class="text-xl font-semibold text-gray-200 mb-4 border-b border-gray-700 pb-3 flex items-center"><i class="ri-settings-5-line mr-3"></i>Opções</h3>
                     <div class="space-y-3">
                        <div class="flex items-center">
                            <input type="checkbox" id="is_featured" name="is_featured" {% if article and article.is_featured %}checked{% endif %} class="form-checkbox">
                            <label for="is_featured" class="ml-2 form-label">Notícia em destaque</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="allow_comments" name="allow_comments" {% if not article or article.allow_comments %}checked{% endif %} class="form-checkbox">
                            <label for="allow_comments" class="ml-2 form-label">Permitir comentários</label>
                        </div>
                     </div>
                </div>

            </div>

        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Inicializar TinyMCE
    tinymce.init({
        selector: '.tinymce',
        plugins: 'autolink lists link image charmap preview anchor searchreplace visualblocks code fullscreen insertdatetime media table help wordcount',
        toolbar: 'undo redo | blocks | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help',
        height: 400,
        skin: (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'oxide-dark' : 'oxide'),
        content_css: (window.matchMedia('(prefers-color-scheme: dark)').matches ? "{{ url_for('static', filename='css/tinymce-dark-content.css') }}" : 'default'),
        menubar: false,
        statusbar: false
    });
    
    // Mostrar/esconder campo de data agendada
    const statusSelect = document.getElementById('status');
    const scheduledDateGroup = document.getElementById('scheduled-date-group');
    if (statusSelect && scheduledDateGroup) {
        statusSelect.addEventListener('change', function() {
            scheduledDateGroup.style.display = (this.value === 'scheduled') ? 'block' : 'none';
        });
    }
});
</script>
{% endblock %} 