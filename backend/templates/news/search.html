{% extends 'base.html' %}

{% block title %}Busca{% if search_query %} - {{ search_query }}{% endif %} - Wellington Despachante RJ{% endblock %}

{% block body_class %}bg-gray-50{% endblock %}

{% block content %}
<!-- Search Header -->
<header class="bg-blue-800 text-white py-16">
    <div class="container mx-auto max-w-7xl px-6 text-center">
        <h1 class="text-4xl md:text-5xl font-extrabold">Resultados da Busca</h1>
        {% if search_query %}
            <p class="text-lg text-blue-200 mt-4">
                {{ results|length }} resultado(s) para <span class="font-bold text-orange-400">"{{ search_query }}"</span>
            </p>
        {% endif %}
    </div>
</header>

<div class="container mx-auto max-w-7xl px-6 py-12">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

        <!-- Sidebar with Filters -->
        <aside class="lg:col-span-4">
            <div class="bg-white p-6 rounded-lg shadow-md sticky top-28">
                <h3 class="text-xl font-bold text-gray-800 mb-6">Filtrar Resultados</h3>
                <form method="GET" action="{{ url_for('search') }}" class="space-y-6">
                    <div>
                        <label for="q" class="block text-sm font-medium text-gray-700">Buscar por termo</label>
                        <input type="text" id="q" name="q" value="{{ request.args.get('q', '') }}" placeholder="Ex: licenciamento" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500">
                    </div>
                    <div>
                        <label for="category_id" class="block text-sm font-medium text-gray-700">Categoria</label>
                        <select id="category_id" name="category_id" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-orange-500">
                            <option value="">Todas</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}" {% if request.args.get('category_id')|int == category.id %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="sort_by" class="block text-sm font-medium text-gray-700">Ordenar por</label>
                        <select id="sort_by" name="sort_by" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-orange-500">
                            <option value="date_desc" {% if request.args.get('sort_by', 'date_desc') == 'date_desc' %}selected{% endif %}>Mais recentes</option>
                            <option value="date_asc" {% if request.args.get('sort_by') == 'date_asc' %}selected{% endif %}>Mais antigos</option>
                            <option value="title_asc" {% if request.args.get('sort_by') == 'title_asc' %}selected{% endif %}>Título (A-Z)</option>
                            <option value="title_desc" {% if request.args.get('sort_by') == 'title_desc' %}selected{% endif %}>Título (Z-A)</option>
                        </select>
                    </div>
                    <div class="flex items-center gap-4 pt-2">
                        <button type="submit" class="w-full bg-orange-500 text-white font-bold py-2 px-4 rounded-md hover:bg-orange-600 transition-colors">
                            Buscar
                        </button>
                        <a href="{{ url_for('search') }}" class="w-full text-center bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-md hover:bg-gray-300 transition-colors">
                            Limpar
                        </a>
                    </div>
                </form>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="lg:col-span-8">
            {% if results %}
            <div class="space-y-8">
                {% for article in results %}
                    <article class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col md:flex-row group">
                        {% if article.featured_image %}
                        <div class="md:w-1/3 flex-shrink-0">
                            <a href="{{ url_for('news_detail', slug=article.slug) }}">
                                <img src="{{ url_for('static', filename='uploads/images/medium/' + article.featured_image) }}" 
                                     alt="{{ article.title }}"
                                     loading="lazy"
                                     class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105">
                            </a>
                        </div>
                        {% endif %}
                        <div class="p-6 flex flex-col justify-between">
                            <div>
                                {% if article.category_rel %}
                                <a href="{{ url_for('blog', category_slug=article.category_rel.slug) }}" class="text-sm font-semibold text-orange-500 hover:text-orange-600 uppercase">{{ article.category_rel.name }}</a>
                                {% endif %}
                                
                                <h2 class="mt-2 text-2xl font-bold text-gray-800">
                                    <a href="{{ url_for('news_detail', slug=article.slug) }}" class="hover:text-gray-600">{{ article.title }}</a>
                                </h2>
                                
                                <p class="mt-4 text-gray-600">
                                    {{ article.meta_description|default(article.content|striptags|truncate(150)) }}
                                </p>
                            </div>
                            
                            <div class="mt-6 flex items-center justify-between text-sm text-gray-500">
                                <div class="flex items-center gap-2">
                                     <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    <span>{{ article.publication_date.strftime('%d de %B, %Y') }}</span>
                                </div>
                                 <a href="{{ url_for('news_detail', slug=article.slug) }}" class="font-semibold text-orange-500 hover:text-orange-600">
                                    Ler mais &rarr;
                                </a>
                            </div>
                        </div>
                    </article>
                {% endfor %}
            </div>
            {% else %}
                <div class="text-center py-16 px-6 bg-white rounded-lg shadow-md">
                    <svg class="w-16 h-16 mx-auto text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    <h3 class="mt-4 text-2xl font-bold text-gray-700">Nenhum resultado encontrado</h3>
                    <p class="mt-2 text-gray-500">Tente ajustar seus filtros de busca para encontrar o que procura.</p>
                    <a href="{{ url_for('blog') }}" class="mt-6 inline-block bg-orange-500 text-white font-bold py-2 px-4 rounded-md hover:bg-orange-600">
                        Ver todos os artigos
                    </a>
                </div>
            {% endif %}
        </main>
    </div>
</div>
{% endblock %} 