{% extends 'base.html' %}

{% block title %}{{ news.title }} - WDespachante{% endblock %}

{% block meta_description %}{{ news.meta_description or news.summary or news.content|striptags|truncate(160) }}{% endblock %}

{% block content %}
<div class="bg-light py-20">
    <div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">

            <!-- Coluna Principal do Artigo -->
            <main class="lg:col-span-8">
                <article class="bg-white rounded-lg shadow-md p-8">
                    <!-- Cabeçalho do Artigo -->
            <header class="mb-8">
                        {% if news.news_category %}
                        <a href="{{ url_for('blog', category_slug=news.news_category.slug) }}" class="inline-block bg-primary-light bg-opacity-10 text-primary text-sm font-semibold px-3 py-1 rounded-full uppercase mb-4">{{ news.news_category.name }}</a>
                    {% endif %}
                        <h1 class="text-3xl md:text-4xl font-extrabold font-heading text-dark mb-4 leading-tight">{{ news.title }}</h1>
                        <div class="flex items-center gap-6 text-sm text-gray-500">
                    <div class="flex items-center gap-2">
                                <i class="fas fa-user"></i>
                                <span>Por <strong>{{ news.author_user.username if news.author_user else 'Equipe' }}</strong></span>
                    </div>
                    <div class="flex items-center gap-2">
                                <i class="fas fa-calendar-alt"></i>
                        <span>{{ news.publication_date.strftime('%d de %B, %Y') }}</span>
                    </div>
                </div>
            </header>

                    <!-- Mídia em Destaque -->
                    {% if news.featured_image_filename %}
                    <div class="my-8 rounded-lg overflow-hidden">
                        <img src="{{ url_for('static', filename='uploads/images/large/' + news.featured_image_filename) }}" alt="{{ news.title }}" class="w-full h-auto object-cover">
                    </div>
                    {% endif %}

                    <!-- Vídeo Incorporado (se houver) -->
                    {% if news.youtube_url %}
                    <div class="my-8 rounded-lg overflow-hidden">
                    <div class="aspect-w-16 aspect-h-9">
                            <iframe src="https://www.youtube.com/embed/{{ news.youtube_url.split('v=')[-1].split('&')[0] if 'youtube.com' in news.youtube_url else news.youtube_url.split('/')[-1] if 'vimeo.com' in news.youtube_url else news.youtube_url }}" 
                                frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen class="w-full h-full rounded">
                            </iframe>
                        </div>
                    </div>
                    {% elif news.video_filename %}
                    <div class="my-8 rounded-lg overflow-hidden">
                        <video controls class="w-full h-auto rounded">
                            <source src="{{ url_for('static', filename='uploads/videos/' + news.video_filename) }}" type="video/mp4">
                            Seu navegador não suporta a tag de vídeo.
                        </video>
                    </div>
                {% endif %}

                    <!-- Galeria de Imagens -->
                    {% if news.gallery_image_filenames %}
                        {% set gallery_images = news.gallery_image_filenames|from_json %}
                        {% if gallery_images %}
                        <div class="my-8 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            {% for img_filename in gallery_images %}
                            <div class="rounded-lg overflow-hidden shadow-sm">
                                <img src="{{ url_for('static', filename='uploads/images/gallery/' + img_filename) }}" alt="Galeria de Imagens" class="w-full h-32 object-cover transition-transform duration-300 hover:scale-105">
                            </div>
                            {% endfor %}
            </div>
                        {% endif %}
                    {% endif %}

                    <!-- Corpo do Artigo -->
                    <div class="prose prose-lg max-w-none text-gray-700 leading-relaxed">
                {{ news.content|safe }}
            </div>

                    <!-- Rodapé do Artigo: Tags e Compartilhamento -->
            <footer class="mt-12 pt-8 border-t border-gray-200">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-8">
                            {% if news.tags %}
                    <div class="flex flex-wrap items-center gap-2">
                                <h3 class="text-lg font-semibold text-dark mr-2">Tags:</h3>
                                {% for tag in news.tags %}
                                <a href="{{ url_for('blog', tag_slug=tag.slug) }}" class="text-sm bg-light text-gray-700 px-3 py-1 rounded-full hover:bg-secondary hover:text-white transition-colors">
                            {{ tag.name }}
                        </a>
                        {% endfor %}
                    </div>
                    {% endif %}

                            <!-- Compartilhamento Social -->
                            <div class="flex items-center gap-3">
                                <h3 class="text-lg font-semibold text-dark mr-2">Compartilhar:</h3>
                                {% set share_url = request.base_url %}
                                {% set share_title = news.social_share_title or news.title %}
                                {% set share_description = news.meta_description or news.summary or news.content|striptags|truncate(150) + '...' %}

                                <!-- WhatsApp -->
                                <a href="https://api.whatsapp.com/send?text={{ share_title | urlencode }}%0A{{ share_url | urlencode }}" target="_blank" class="text-green-500 hover:text-green-600 transition-colors" title="Compartilhar no WhatsApp">
                                    <i class="fab fa-whatsapp text-2xl"></i>
                                </a>
                                <!-- Facebook -->
                                <a href="https://www.facebook.com/sharer/sharer.php?u={{ share_url | urlencode }}&quote={{ share_title | urlencode }}" target="_blank" class="text-blue-600 hover:text-blue-700 transition-colors" title="Compartilhar no Facebook">
                                    <i class="fab fa-facebook text-2xl"></i>
                                </a>
                                <!-- Twitter (X) -->
                                <a href="https://twitter.com/intent/tweet?url={{ share_url | urlencode }}&text={{ share_title | urlencode }}&via=WDespachante" target="_blank" class="text-blue-400 hover:text-blue-500 transition-colors" title="Compartilhar no X (Twitter)">
                                    <i class="fab fa-x-twitter text-2xl"></i>
                                </a>
                                <!-- LinkedIn -->
                                <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ share_url | urlencode }}&title={{ share_title | urlencode }}&summary={{ share_description | urlencode }}" target="_blank" class="text-blue-700 hover:text-blue-800 transition-colors" title="Compartilhar no LinkedIn">
                                    <i class="fab fa-linkedin text-2xl"></i>
                                </a>
                    </div>
                </div>
            </footer>
        </article>

                <!-- Seção de Comentários -->
{% if news.allow_comments %}
                <section id="comments" class="bg-white rounded-lg shadow-md p-8 mt-12">
                    <h2 class="text-2xl font-bold font-heading text-dark mb-8">Comentários</h2>
                    <!-- Formulário de Comentário -->
                    <div class="bg-light p-8 rounded-lg mb-12">
                        <h3 class="text-xl font-bold text-dark mb-4">Deixe seu comentário</h3>
                        <form action="#" method="POST" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">Nome <span class="text-red-500">*</span></label>
                                    <input type="text" id="name" name="name" required class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Email <span class="text-red-500">*</span></label>
                                    <input type="email" id="email" name="email" required placeholder="Seu email não será publicado" class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent">
                    </div>
                </div>
                <div>
                    <label for="content" class="block text-sm font-medium text-gray-700">Comentário <span class="text-red-500">*</span></label>
                                <textarea id="content" name="content" rows="5" required class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent"></textarea>
                </div>
                            <button type="submit" class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-secondary hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary">
                    Enviar Comentário
                </button>
            </form>
                    </div>
                </section>
                {% endif %}
            </main>

            <!-- Barra Lateral -->
            <aside class="lg:col-span-4 space-y-8">
                <!-- Artigos Recentes -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold font-heading text-dark mb-4">Artigos Recentes</h3>
                    <ul class="space-y-4">
                        {% if latest_news %}
                            {% for recent_article in latest_news %}
                            <li class="flex items-center gap-4">
                                <a href="{{ url_for('news_detail', slug=recent_article.slug) }}" class="flex-shrink-0">
                                    <img src="{{ url_for('static', filename='uploads/images/thumb/' + recent_article.featured_image_filename) if recent_article.featured_image_filename else url_for('static', filename='images/placeholder_profile.jpg') }}" alt="{{ recent_article.title }}" class="w-16 h-16 rounded-md object-cover">
                                </a>
                                <div>
                                    <h4 class="font-semibold text-dark leading-tight">
                                        <a href="{{ url_for('news_detail', slug=recent_article.slug) }}" class="hover:text-primary">{{ recent_article.title }}</a>
                                    </h4>
                                     <p class="text-xs text-gray-500 mt-1">{{ recent_article.publication_date.strftime('%d/%m/%Y') }}</p>
                        </div>
                            </li>
                            {% endfor %}
                        {% else %}
                            <p class="text-sm text-gray-500">Nenhum artigo recente encontrado.</p>
                        {% endif %}
                    </ul>
                </div>
            </aside>

        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        const copyBtn = document.querySelector('.copy-btn');
        const originalIcon = copyBtn.innerHTML;
        copyBtn.innerHTML = '<i class="fas fa-check"></i>';
        copyBtn.title = 'Copiado!';
        setTimeout(() => {
            copyBtn.innerHTML = originalIcon;
            copyBtn.title = 'Copiar Link';
        }, 2000);
    }).catch(() => {
        alert('Erro ao copiar o link.');
    });
}
</script>
{% endblock %} 